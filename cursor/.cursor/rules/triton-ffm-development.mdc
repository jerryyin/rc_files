---
globs: **/triton*/**
alwaysApply: false
---
# FFM Environment for Triton Development

When working on Triton with FFM (Functional Model) for gfx1250.

## Automatic Setup

The FFM environment is **automatically loaded** by `~/.zshrc` when `/ffm` exists.
No manual setup is required in interactive shells.

## Environment Variables (Reference)

These variables are set automatically by `load_ffm_env()` in `~/.zshrc`:

```bash
# FFM HSA model configuration
export TEST_SUIT_DIR="/ffm"
export HSA_MODEL_LIB="/ffm/lib/libhsakmtmodel.so"
export HSA_MODEL_TOPOLOGY="/ffm/topology/mi450"
export HSA_ENABLE_SDMA=0
export HSA_ENABLE_INTERRUPT=0
export HSA_KMT_MODEL_GPUVM_BASE=0x4000

# LD_LIBRARY_PATH: ROCm libs must come FIRST to avoid libamd_smi.so conflicts
export LD_LIBRARY_PATH="/opt/rocm/lib:/ffm:/ffm/lib:$LD_LIBRARY_PATH"
```

## Manual Setup (Non-Interactive Shells Only)

If running in a non-interactive shell or script where `~/.zshrc` isn't sourced:

```bash
source ~/.zshrc  # Loads load_ffm_env() automatically
```

Or directly source the FFM environment:

```bash
cd /ffm && source ./ffmlite_env.sh && cd -
export LD_LIBRARY_PATH=/opt/rocm/lib:$LD_LIBRARY_PATH
```
