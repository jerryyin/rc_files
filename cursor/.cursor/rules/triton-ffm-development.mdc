---
globs: **/triton/**
alwaysApply: false
---
# FFM Environment for Triton Development

When working on Triton with FFM (Functional Model) for gfx1250, the following environment setup is required.

## Terminal Environment Variables

Before running any Triton tests or compiling kernels in the terminal, ensure these environment variables are set:

```bash
# FFM HSA model configuration
export TEST_SUIT_DIR="/ffm"
export HSA_MODEL_LIB="/ffm/lib/libhsakmtmodel.so"
export HSA_MODEL_TOPOLOGY="/ffm/topology/mi450"
export HSA_ENABLE_SDMA=0
export HSA_ENABLE_INTERRUPT=0
export HSA_KMT_MODEL_GPUVM_BASE=0x4000

# LD_LIBRARY_PATH: ROCm libs must come FIRST to avoid libamd_smi.so conflicts
export LD_LIBRARY_PATH="/opt/rocm/lib:/ffm:/ffm/lib:$LD_LIBRARY_PATH"
```

## Quick Setup

If `/ffm` exists, you can source the environment with:

```bash
cd /ffm && source ./ffmlite_env.sh && cd -
export LD_LIBRARY_PATH=/opt/rocm/lib:$LD_LIBRARY_PATH
```
