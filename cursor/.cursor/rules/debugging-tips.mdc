---
globs: 
---

# Debugging Tips

## Build System Debugging

### CMake Debug Output

```bash
# Verbose CMake configuration
cmake /path/to/source --debug-output

# Trace CMake execution
cmake /path/to/source --trace

# See all CMake variables
cmake -LAH /path/to/build
```

### Make/Ninja Verbose Output

```bash
# Make verbose
make VERBOSE=1

# Ninja verbose
ninja -v

# CMake with verbose
cmake --build . --verbose
```

### Compiler Commands

```bash
# Generate compile_commands.json for tooling
cmake /path/to/source -DCMAKE_EXPORT_COMPILE_COMMANDS=ON

# View compile commands for specific file
ninja -t commands path/to/file.cpp
```

## Dependency Debugging

### Check Library Dependencies

```bash
# ldd for runtime dependencies
ldd /path/to/binary

# Check what a library provides
nm -D /path/to/library.so

# Check undefined symbols
nm -u /path/to/binary
```

### CMake Find Modules

```bash
# Debug find_package
cmake /path/to/source -DCMAKE_FIND_DEBUG_MODE=ON

# Check what CMake found
cmake -LAH | grep -i packagename
```

## Build Failures

### Incremental Build Issues

Sometimes incremental builds get into bad states:

```bash
# Clean build artifacts but keep CMake cache
cmake --build . --target clean

# Nuclear option: full rebuild
rm -rf * && cmake /path/to/source [flags]
```

### Compiler Cache Issues

If using ccache or sccache:

```bash
# Clear ccache
ccache -C

# Check ccache stats
ccache -s
```

## Git/Submodule Issues

### Submodule Problems

```bash
# Check submodule status
git submodule status

# Update submodules
git submodule update --init --recursive

# Clean submodules
git submodule foreach --recursive git clean -xfd
```

### Worktree Issues

```bash
# List worktrees
git worktree list

# Repair worktrees
git worktree repair
```

## Performance Debugging

### Build Performance

```bash
# Time the build
time cmake --build . -j$(nproc)

# Ninja build times
ninja -d stats

# Find slow compilation units
ninja -d keeprsp -v 2>&1 | grep "elapsed"
```

## Common Issues

### Issue: "Could not find package"
**Solution:** Check CMAKE_PREFIX_PATH, ensure dependency is installed

### Issue: Build hangs
**Solution:** Check for infinite loops in CMake, reduce parallelism with `-j4`

### Issue: Linker errors
**Solution:** Check library order, ensure all dependencies are linked

## Useful Tools

- `ldd` - List shared library dependencies
- `nm` - List symbols from object files
- `objdump` - Display information from object files
- `readelf` - Display ELF file information
- `strace` - Trace system calls
- `ltrace` - Trace library calls
